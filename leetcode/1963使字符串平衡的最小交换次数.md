# 5840. 使字符串平衡的最小交换次数

### 题目（中等）

给你一个字符串 `s` ，**下标从 0 开始** ，且长度为偶数 `n` 。字符串 **恰好** 由 `n / 2` 个开括号 `'['` 和 `n / 2` 个闭括号 `']'` 组成。

只有能满足下述所有条件的字符串才能称为 **平衡字符串 **：

- 字符串是一个空字符串，或者
- 字符串可以记作 `AB` ，其中 `A` 和 `B` 都是 **平衡字符串** ，或者
- 字符串可以写成 `[C]` ，其中 `C` 是一个 **平衡字符串** 。

你可以交换 **任意** 两个下标所对应的括号 **任意** 次数。

返回使 `s` 变成 **平衡字符串** 所需要的 **最小** 交换次数。

示例 1：

> 输入：s = "]\[\]["
> 输出：1
> 解释：交换下标 0 和下标 3 对应的括号，可以使字符串变成平衡字符串。
> 最终字符串变成 "[[]]" 。

示例 2：

> 输入：s = "]]][[["
> 输出：2
> 解释：执行下述操作可以使字符串变成平衡字符串：
> - 交换下标 0 和下标 4 对应的括号，s = "[]][[]" 。
> - 交换下标 1 和下标 5 对应的括号，s = "[[][]]" 。
> 最终字符串变成 "[[][]]" 。

示例 3：

> 输入：s = "[]"
> 输出：0
> 解释：这个字符串已经是平衡字符串。


提示：

- `n == s.length`
- ``2 <= n <= 10^6``
- `n` 为偶数
- `s[i]` 为`'['` 或 `']'`
- 开括号 `'['` 的数目为 `n / 2` ，闭括号 `']'` 的数目也是 `n / 2`

### 解题思路

#### 方法一：栈

**用栈将匹配的'[]'的消除，就能得到类似']]][[['这样形式的结果，然后对这种形式找规律计算最小替换次数。**

假设有1个`]`，`] [ => [ ]`，解释：替换第1个`']'`为`'['`，使得1和2形成匹配关系，替换了1次；
假设有2个`]`，`]] [[ => [] []`，解释：替换第1个`']'`为`'['`，使得1和2形成匹配关系的同时，2和3刚好也形成了匹配关系，替换了1次；
假设有3个`]`，`]]] [[[ => [][ ][]`，解释：替换第1个，第3个，替换了2次；
假设有4个`]`，`]]]] [[[[ => [][] [][]`，解释：替换第1个，第3个，替换了2次；
假设有n个`]`，替换规律为每隔一个`']'` 替换一次`(1，3，5，...)`，替换了`(n+1)/2`次。

##### 复杂度分析

- 时间复杂度：$$O(n)$$
- 空间复杂度：$$O(n)$$

#### 方法二：贪心

对于一个平衡字符串，从左往右遍历它，统计未匹配的左括号的个数 c，遇到左括号就加一，遇到右括号就减一。

- 如果任何时刻 c 都不为负数，那么这个字符串就是平衡的。

- 如果遍历时遇到右括号并且此时 c=0，那么就需要在后面找一个左括号并与这个右括号交换。

为了使后续的交换次数最小，这个被交换走的右括号应当越靠右越好，所以我们可以拿字符串最右边的左括号来交换。

实际代码中，可以不用编写「交换」的逻辑，这是因为我们总是选择最右边的左括号，因此在后续的遍历中，若遇到了这些左括号，在交换后的字符串上，该位置及后面必然全部是右括号，即此时该字符串已经是平衡的了。

##### 复杂度分析

- 时间复杂度：$$O(n)$$
- 空间复杂度：$$O(1)$$

#### 方法三：猜测结论 + 构造答案

记 $$\textit{cnt}[i]$$ 表示字符串 $$s[0..i]$$ 的前缀和，其中左括号 `[` 记为 `1`，右括号 `]` 记为 `−1`。

如果所有的前缀和均大于等于 `0`，那么字符串 `s` 就是平衡的。

我们可以猜测一个结论：

设 $$\textit{cnt}$$ 中的最小值为 $$\textit{cnt}[i]$$，那么最少需要交换的次数为：

$$
\lceil \frac{-\textit{cnt}[i]}{2} \rceil
$$
其中 $$\lceil x \rceil$$ 表示将 $$x$$​ 向上取整。

猜测这个结论的缘由是比较直观的：$$\textit{cnt}[i]$$ 表示遍历的过程中，栈最多欠了 $$-\textit{cnt}[i]$$ 个左括号。为了使得 $$s$$ 平衡，我们需要在此之前补上一些左括号，而补括号的唯一方法是将前面的右括号与后面的左括号进行交换，一次交换会使得 $$\textit{cnt}[i]$$ 的值增加 $$2$$（原先是右括号权值为 $$-1$$，现在是左括号权值为 $$1$$，变化量为 $$2$$​），因此至少需要交换 $$\lceil \dfrac{-\textit{cnt}[i]}{2} \rceil$$​次。

##### 复杂度分析

- 时间复杂度：$$O(n)$$
- 空间复杂度：$$O(1)$$

### 代码

```java
class Solution {
    public int minSwaps(String s) {
        Stack<Character> stack = new Stack<>();
        for (char c : s.toCharArray()) {
            if (c == '[') {
                stack.push(c);
            } else {
                if (!stack.isEmpty() && stack.peek() == '[') {
                    stack.pop();
                }
            }
        }
        return (stack.size() + 1) / 2;
    }
}
```

```java
class Solution {
    public int minSwaps(String s) {
        int cnt = 0, ans = 0;
        for (char c : s.toCharArray()) {
            if (c == '[') {
                cnt++;
            } else if (cnt > 0) {
                cnt--;
            } else {
                cnt++;
                ans++;
            }
        }
        return ans;
    }
}
```

```java
class Solution {
    public int minSwaps(String s) {
        int cnt = 0, min = s.length();
        for (char c : s.toCharArray()) {
            if (c == '[') {
                cnt++;
            } else {
                cnt--;
            }
            min = Math.min(cnt, min);
        }
        return (-min + 1) / 2;
    }
}
```

