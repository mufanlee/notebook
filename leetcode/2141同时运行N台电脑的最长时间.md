# 5983. 同时运行 N 台电脑的最长时间

### 题目

你有 `n` 台电脑。给你整数 `n` 和一个下标从 **0** 开始的整数数组 `batteries` ，其中第 `i` 个电池可以让一台电脑 **运行** `batteries[i]` 分钟。你想使用这些电池让 **全部** `n` 台电脑 **同时** 运行。

一开始，你可以给每台电脑连接 **至多一个电池** 。然后在任意整数时刻，你都可以将一台电脑与它的电池断开连接，并连接另一个电池，你可以进行这个操作 **任意次** 。新连接的电池可以是一个全新的电池，也可以是别的电脑用过的电池。断开连接和连接新的电池不会花费任何时间。

注意，你不能给电池充电。

请你返回你可以让 `n` 台电脑同时运行的 **最长** 分钟数。

 

**示例 1：**

![img](5983%E5%90%8C%E6%97%B6%E8%BF%90%E8%A1%8C%20N%20%E5%8F%B0%E7%94%B5%E8%84%91%E7%9A%84%E6%9C%80%E9%95%BF%E6%97%B6%E9%97%B4.assets/example1-fit.png)

```
输入：n = 2, batteries = [3,3,3]
输出：4
解释：
一开始，将第一台电脑与电池 0 连接，第二台电脑与电池 1 连接。
2 分钟后，将第二台电脑与电池 1 断开连接，并连接电池 2 。注意，电池 0 还可以供电 1 分钟。
在第 3 分钟结尾，你需要将第一台电脑与电池 0 断开连接，然后连接电池 1 。
在第 4 分钟结尾，电池 1 也被耗尽，第一台电脑无法继续运行。
我们最多能同时让两台电脑同时运行 4 分钟，所以我们返回 4 。
```

**示例 2：**

![img](5983%E5%90%8C%E6%97%B6%E8%BF%90%E8%A1%8C%20N%20%E5%8F%B0%E7%94%B5%E8%84%91%E7%9A%84%E6%9C%80%E9%95%BF%E6%97%B6%E9%97%B4.assets/example2.png)

```
输入：n = 2, batteries = [1,1,1,1]
输出：2
解释：
一开始，将第一台电脑与电池 0 连接，第二台电脑与电池 2 连接。
一分钟后，电池 0 和电池 2 同时耗尽，所以你需要将它们断开连接，并将电池 1 和第一台电脑连接，电池 3 和第二台电脑连接。
1 分钟后，电池 1 和电池 3 也耗尽了，所以两台电脑都无法继续运行。
我们最多能让两台电脑同时运行 2 分钟，所以我们返回 2 。
```

 

**提示：**

- `1 <= n <= batteries.length <= 10^5`
- `1 <= batteries[i] <= 10^9`

### 解题思路

#### 方法一：二分答案

假设我们可以让 $$n$$ 台电脑同时运行 $$x$$ 分钟，那么对于电量大于 $$x$$ 的电池，其只能被使用 $$x$$ 分钟，因此每个电池的使用时间为 $$\min(\textit{batteries}[i], x)$$，我们将其累加起来，记作 $$sum$$。那么要让 $$n$$ 台电脑同时运行 $$x$$ 分钟，必要条件是 $$n⋅x≤sum$$。

下面证明该条件是充分的，即当 $$n⋅x≤sum$$ 成立时，必然可以让 $$n$$ 台电脑同时运行 $$x$$ 分钟。

对于电量不小于 $$x$$ 的电池，我们可以让其给一台电脑供电 $$x$$ 分钟。由于一个电池不能同时给多台电脑供电，因此该电池若给一台电脑供电 $$x$$ 分钟，那它就不能用于其他电脑了。我们可以将所有电量不小于 $$x$$ 的电池各给一台电脑供电。

对于其余的电池，设其电量和为 $$\textit{sum}'$$，剩余 $$n′$$ 台电脑未被供电。我们可以随意选择剩下的电池，供给剩余的第一台电脑，多余的电池电量供给剩余的第二台电脑，依此类推。注意由于这些电池的电量小于 $$x$$，按照这种做法是不会出现同一个电池在同一时间供给多台电脑的。

由于 $$\textit{sum}'=\textit{sum}-(n-n')\cdot x$$，结合 $$n⋅x≤sum$$ 可以得到 $$n′⋅x≤sum′$$，这意味着剩余电池可以让剩余电脑运行 $$x$$ 分钟。充分性得证。

如果我们可以让 $$n$$ 台电脑同时运行 $$x$$ 分钟，那么必然也可以同时运行低于 $$x$$ 分钟，因此答案满足单调性，可以二分答案，通过判断 $$n⋅x≤sum$$ 来求解。

##### 复杂度分析

- 时间复杂度：$O(nlog(k))$，$$k$$ 为 $$batteries$$ 和除以 $$n$$。
- 空间复杂度：$O(1)$

### 代码

```java
class Solution {
    public long maxRunTime(int n, int[] batteries) {
        Predicate<Long> check = (x) -> {
            long sum = 0;
            for (int b : batteries) {
                sum += Math.min(b, x);
            }
            return x * n <= sum;
        };

        long tot = 0;
        for (int b : batteries) tot += b;
        long l = 1, r = tot / n + 1;
        while (l < r) {
            long mid = l + r + 1 >> 1;
            if (check.test(mid)) {
                l = mid;
            } else {
                r = mid - 1;
            }
        }
        return l;
    }
}
```

