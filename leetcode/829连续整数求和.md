# [829. 连续整数求和](https://leetcode.cn/problems/consecutive-numbers-sum/)

### 题目（困难）

给定一个正整数 `n`，返回 *连续正整数满足所有数字之和为 `n` 的组数* 。 

 

示例 1:

```
输入: n = 5
输出: 2
解释: 5 = 2 + 3，共有两组连续整数([5],[2,3])求和后为 5。
```


示例 2:

```
输入: n = 9
输出: 3
解释: 9 = 4 + 5 = 2 + 3 + 4
```


示例 3:

```
输入: n = 15
输出: 4
解释: 15 = 8 + 7 = 4 + 5 + 6 = 1 + 2 + 3 + 4 + 5
```



提示:

- $1 <= n <= 10^9$

### 解题思路

#### 方法一：数论

假设存在某个连续正整数段之和为 $n$，假定该段首项为 $a$，项数为 $k$，根据 **等差数列求和** 可得：
$$
\frac{a+a+k-1 \times k}{2} = n
$$
简单变形可得：
$$
(2a+k-1) \times k = 2n
$$

$$
2a = \frac{2n}{k} - k + 1
$$

根据首项 $a$ 和 $k$ 均为正整数，可得：
$$
2a = \frac{2n}{k} - k + 1 \ge 2
$$
进一步可得：
$$
\frac{2n}{k} \ge k + 1
$$

$$
\frac{2n}{k} \gt k
$$

$$
k \lt \sqrt{2n}
$$

综上，根据 $(2a+k-1) \times k = 2n$ 和 $\frac{2n}{k} \gt k$ 可知，$k$ 必然是 $2n$ 的约数，且为较小的约数。

因此我们可以在 $[1,\sqrt{2n})$ 范围内枚举 $k$，如果 $k$ 为 $2n$ 的约数，并且结合 $(2a+k-1) \times k = 2n$ 可验证 $a$ 合法，说明找到了一组合法的 $(a,k)$，并对答案进行累加。

##### 复杂度分析

- 时间复杂度：$\sqrt{2n}$。
- 空间复杂度：$O(1)$。

### 代码

```java
class Solution {
    public int consecutiveNumbersSum(int n) {
        int ans = 0; n *= 2;
        for (int k = 1; k * k < n; k++) {
            if (n % k != 0) continue;
            if ((n / k - (k - 1)) % 2 == 0) ans++;
        }
        return ans;
    }
}
```

